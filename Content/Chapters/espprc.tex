\chapter{The ESPPRC}
In this chapter we will introduce more formally the Elementary Shortest Path Problem with Resource Constraints (ESPPRC).
In this thesis we interested in studying the ESPPRC induced from the PP when solving the RMP through a BAP framework employing the usage of robust inequalities only.


\section{ESPPRC: IP formulation}
Contrary to CVRP, the ESPPRC is usually defined over a directed network $G^\prime = (V^\prime, E^\prime)$ composed
of $N + 1$ nodes where the original depot node is essentially split in two nodes: a source and a sink vertex.
In the new network we use the value $0$ to denote the source version of the depot node, and $N$ its duplicate
playing the role of the sink vertex.
More formally, $V^\prime = V \cup Set*{N} = \Set*{ 0,\dots, N }$, and the edge set $E^\prime$ is

\begin{equation}
	\begin{aligned}
		E^\prime = & \Set*{\Tuple*{i, j} \quad \forall i, j \in V^\prime,\ i \ne j } \\
		           & \setminus \Set*{ \Tuple*{0, N} }                                \\
		           & \setminus \Set*{ \Tuple*{i, 0} \quad \forall i \in V^\prime }   \\
		           & \setminus \Set*{ \Tuple*{N, i} \quad \forall i \in V^\prime }   \\
	\end{aligned}
\end{equation}

which briefly means: all possible pairs $\Tuple*{i, j},\ i \ne j$ excluding: direct connection between $0$ and $N$, and by exluding edges entering node $0$ and flowing out of node $N$.
At each directed edge $\Tuple*{i, j} \in E^\prime$ we have an associated weight $\bar{c_{ij}} \in \R$ which is directly linked to the dual variables of the RMP through the following equation:

\begin{equation}
	\bar{c_{ij}} = d_{ij} - \frac{\pi_i + \pi_j}{2} \quad \forall i, j \in V^\prime
\end{equation}

where $\pi$ represent the dual variables associated to constraints constraints \eqref{eq:mp-customers-visited-by-exactly-one-route}\eqref{eq:mp-K-routes},
as was already explained in Section \ref{sec:column-generation-and-pricing-problem}.

Let $x_{ij} \in \Set*{0, 1} \quad \forall i, j \in V^\prime$ be a new set of binary variables
encoding feasible solutions for the ESPRCC problem (i.e. $x_{ij} = 1$ if edge $(i, j)$ is picked in the optimal path).
We can finally write the full ESPPRC IP formulation as:

\begin{align}
	\min_{x} \quad z_\mt{ESPPRC}(x) & =  \sum_{(i, j) \in E^\prime} \bar{c_{ij}} x_{ij} \label{eq:espprc-obj-function}                                                                                                               \\
	                                & \sum_{i \in V_0} \frac{q_i}{2} \Expr*{ \ExprESPPIngoingEdges{i} + \ExprESPPOutgoingEdges{i} }  \le Q                            \label{eq:espprc-resource-upper-bound-constraint}              \\
	                                & \ExprESPPIngoingEdges{i} = \ExprESPPOutgoingEdges{i}                                                \qquad \forall i \in V_0          \label{eq:espprc-flow-conservation-constraint-customers} \\
	                                & \ExprESPPOutgoingEdges[i]{0} = 1                                                                                                      \label{eq:espprc-flow-conservation-constraint-depot1}    \\
	                                & \ExprESPPIngoingEdges[i]{N} = 1                                                                                                       \label{eq:espprc-flow-conservation-constraint-depot2}    \\
	                                & \ExprESPPEdgesWithin[S] \le |S| - 1                                                                  \qquad \forall S \subseteq V^\prime   \label{eq:espprc-sec-constraints}                   \\
	                                & x_{0i} + x_{iN} \le 1                                                                                \qquad \forall i \in V_0         \label{eq:espprc-binding-directed}                       \\
	                                & x_{ij}                   \in \lbrace 0, 1 \rbrace                                                    \qquad \forall \Tuple*{i, j} \in E^\prime    \label{eq:espprc-x-mip-var-bounds}           \\
\end{align}

where, \eqref{eq:espprc-obj-function} is the objective function which we aim to minimize.
The remaining constraints characterize the set of feasible paths $P$, by paying attention that we are now dealing with
a directed network, and the depot node is duplicated twice.
Namely, constraint \eqref{eq:espprc-resource-upper-bound-constraint} expresses the resource bound modeled as a function of only the $x$ MIP variables,
constraint \eqref{eq:espprc-flow-conservation-constraint-customers} imposes a flow conservation for all vertices excluding the source and the sink node,
constraint \eqref{eq:espprc-flow-conservation-constraint-depot1}, \eqref{eq:espprc-flow-conservation-constraint-depot2} are the flow imposition for respectively the source and sink node,
constraint \eqref{eq:espprc-sec-constraints} are the subtour elimination constraints which avoid the forming of spurious subtours in unconnected regions of nodes,
constraint  \eqref{eq:espprc-binding-directed} avoids forming paths where a single customer is visited, this constraint is a direct consequence of the fact that the CVRP is defined over an undirected network,
and finally, constraint \eqref{eq:espprc-x-mip-var-bounds} imposes bound and integrality constraints on the $x$ MIP variables.

\begin{center}
	\begin{tikzpicture}[>=stealth, main/.style = {draw, circle, fill=black!10!white}]
		\centering

		\node[main] (0) at (0.1\textwidth,0bp) {0};
		\node[main] (1) at (0.3\textwidth,0bp){1};
		\node[main] (2) at (0.5\textwidth,0bp){2};
		\node[main] (3) at (0.4\textwidth,-40bp) {3};
		\node[main] (4) at (0.5\textwidth,-80bp) {4};
		\node[main] (5) at (0.6\textwidth,-40bp) {5};
		\node[main] (6) at (0.7\textwidth,0bp){6};
		\node[main] (7) at (0.9\textwidth,0bp) {7};

		\draw [->,thick] (0) -- (1);
		\draw [->,thick] (1) -- (2);
		\draw [->,thick] (2) -- (3);
		\draw [->,thick] (3) -- (4);
		\draw [->,thick] (4) -- (5);
		\draw [->,thick] (5) -- (2);
		\draw [->,thick] (2) -- (6);
		\draw [->,thick] (6) -- (7);
	\end{tikzpicture}
\end{center}
